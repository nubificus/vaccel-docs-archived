
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>Google Coral TPU - vAccel</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#google-coral-tpu" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="vAccel" class="md-header-nav__button md-logo" aria-label="vAccel">
      
  <img src="../img/vaccel-logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            vAccel
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Google Coral TPU
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="vAccel" class="md-nav__button md-logo" aria-label="vAccel">
      
  <img src="../img/vaccel-logo.png" alt="logo">

    </a>
    vAccel
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
      
      <label class="md-nav__link" for="nav-3">
        User Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../vaccelrt/" class="md-nav__link">
        Building the vAccel Runtime
      </a>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2" checked>
      
      <label class="md-nav__link" for="nav-3-2">
        Plugins
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Plugins" data-md-level="2">
        <label class="md-nav__title" for="nav-3-2">
          <span class="md-nav__icon md-icon"></span>
          Plugins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../jetson/" class="md-nav__link">
        Jetson-inference
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../virtio/" class="md-nav__link">
        Virtio
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Google Coral TPU
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Google Coral TPU
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#patch-the-code" class="md-nav__link">
    Patch the code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-the-latest-edge-tpu-runtime" class="md-nav__link">
    Download the latest Edge TPU runtime
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-and-build-tensorflow" class="md-nav__link">
    Download and build Tensorflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-shared-library" class="md-nav__link">
    Build the shared library
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-vaccelrt-plugin" class="md-nav__link">
    Build vAccelRT plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-files" class="md-nav__link">
    Extra Files
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../run/" class="md-nav__link">
        Running a simple example
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../kata-vaccel/" class="md-nav__link">
        vAccel on kata containers
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
      
      <label class="md-nav__link" for="nav-5">
        k8s
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="k8s" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          k8s
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../k8s/kata/" class="md-nav__link">
        vAccel on k8s using Kata-containers & Firecracker
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
      
      <label class="md-nav__link" for="nav-6">
        Unikernels
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Unikernels" data-md-level="1">
        <label class="md-nav__title" for="nav-6">
          <span class="md-nav__icon md-icon"></span>
          Unikernels
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../unikernels/unikraft/" class="md-nav__link">
        How to run a vAccel application using Unikraft
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#patch-the-code" class="md-nav__link">
    Patch the code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-the-latest-edge-tpu-runtime" class="md-nav__link">
    Download the latest Edge TPU runtime
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-and-build-tensorflow" class="md-nav__link">
    Download and build Tensorflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-shared-library" class="md-nav__link">
    Build the shared library
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-vaccelrt-plugin" class="md-nav__link">
    Build vAccelRT plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-files" class="md-nav__link">
    Extra Files
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="google-coral-tpu">Google Coral TPU</h1>
<p>To build the vAccel Google Coral TPU plugin, we will use a simple image classification example based on <code>tflite</code></p>
<p>To execute an image classification operation on the Google Coral TPU, we first
need to implement the operation using one of the available acceleration
frameworks and then register this function to the vAccel plugin we are
building. </p>
<p>To achieve this, we patch a <code>tflite</code> example for Google coral, and
build the available image classification function as a shared library, exposing
the following API to the relevant plugin:</p>
<pre><code class="language-c">int coral_classify(char *model_file_ptr,
                   char *label_file_ptr,
                   char *image_file_ptr,
                   float thres,
                   char **tags,
                   size_t *out_len) 
</code></pre>
<h2 id="patch-the-code">Patch the code</h2>
<p>The first step in order to build the library is to get the example code from
the Google Coral github repo:</p>
<pre><code>git clone https://github.com/google-coral/tflite
</code></pre>
<p>Then we need to apply the following patch (<code>libify_classify.patch</code>) to the relevant example:</p>
<pre><code class="language-patch">diff --git a/cpp/examples/classification/classify.cc b/cpp/examples/classification/classify.cc
index 69dfe04..1129976 100644
--- a/cpp/examples/classification/classify.cc
+++ b/cpp/examples/classification/classify.cc
@@ -22,6 +22,72 @@ int32_t ToInt32(const char p[4]) {
   return (p[3] &lt;&lt; 24) | (p[2] &lt;&lt; 16) | (p[1] &lt;&lt; 8) | p[0];
 }

+std::vector&lt;uint8_t&gt; ReadBmpImageFromBuf(char* buf,
+                                  int* out_width = nullptr,
+                                  int* out_height = nullptr,
+                                  int* out_channels = nullptr) {
+  char header[kBmpHeaderSize];
+  memcpy(header, buf, sizeof(header));
+
+  const char* file_header = header;
+  const char* info_header = header + kBmpFileHeaderSize;
+  char *ptr = buf + sizeof(header);
+
+  if (file_header[0] != 'B' || file_header[1] != 'M')
+    return {};  // Invalid file type.
+
+  const int channels = info_header[14] / 8;
+  if (channels != 1 &amp;&amp; channels != 3) return {};  // Unsupported bits per pixel.
+
+  if (ToInt32(&amp;info_header[16]) != 0) return {};  // Unsupported compression.
+
+  uint32_t offset = ToInt32(&amp;file_header[10]);
+#if 0
+  if (offset &gt; kBmpHeaderSize)// &amp;&amp; 
+      //!file.seekg(offset - kBmpHeaderSize, std::ios::cur))
+    return {};  // Seek failed.
+#endif
+
+  offset -= kBmpHeaderSize;
+  //printf(&quot;kBmpFileHeaderSize:%d\n&quot;, kBmpFileHeaderSize);
+  //printf(&quot;kBmpHeaderSize:%d\n&quot;, kBmpHeaderSize);
+  //printf(&quot;offset:%d\n&quot;, offset);
+  ptr = ptr+offset;
+  int width = ToInt32(&amp;info_header[4]);
+  if (width &lt; 0) return {};  // Invalid width.
+
+  int height = ToInt32(&amp;info_header[8]);
+  const bool top_down = height &lt; 0;
+  if (top_down) height = -height;
+
+  const int line_bytes = width * channels;
+  const int line_padding_bytes =
+      4 * ((8 * channels * width + 31) / 32) - line_bytes;
+  std::vector&lt;uint8_t&gt; image(line_bytes * height);
+  for (int i = 0; i &lt; height; ++i) {
+    uint8_t* line = &amp;image[(top_down ? i : (height - 1 - i)) * line_bytes];
+    memcpy(line, ptr, line_bytes);
+#if 0
+    if (!file.read(reinterpret_cast&lt;char*&gt;(line), line_bytes))
+      return {};  // Read failed.
+    if (!file.seekg(line_padding_bytes, std::ios::cur))
+      return {};  // Seek failed.
+#endif
+    //printf(&quot;line_bytes: %d line_padding_bytes:%d\n&quot;, line_bytes, line_padding_bytes);
+    ptr = ptr + line_padding_bytes;
+    ptr = ptr + line_bytes;
+    if (channels == 3) {
+      for (int j = 0; j &lt; width; ++j) std::swap(line[3 * j], line[3 * j + 2]);
+    }
+  }
+
+  if (out_width) *out_width = width;
+  if (out_height) *out_height = height;
+  if (out_channels) *out_channels = channels;
+  return image;
+}
+
+
 std::vector&lt;uint8_t&gt; ReadBmpImage(const char* filename,
                                   int* out_width = nullptr,
                                   int* out_height = nullptr,
@@ -50,6 +116,9 @@ std::vector&lt;uint8_t&gt; ReadBmpImage(const char* filename,
       !file.seekg(offset - kBmpHeaderSize, std::ios::cur))
     return {};  // Seek failed.

+  printf(&quot;kBmpFileHeaderSize:%d\n&quot;, kBmpFileHeaderSize);
+  printf(&quot;kBmpHeaderSize:%d\n&quot;, kBmpHeaderSize);
+  printf(&quot;offset:%d\n&quot;, offset);
   int width = ToInt32(&amp;info_header[4]);
   if (width &lt; 0) return {};  // Invalid width.

@@ -63,6 +132,7 @@ std::vector&lt;uint8_t&gt; ReadBmpImage(const char* filename,
   std::vector&lt;uint8_t&gt; image(line_bytes * height);
   for (int i = 0; i &lt; height; ++i) {
     uint8_t* line = &amp;image[(top_down ? i : (height - 1 - i)) * line_bytes];
+    printf(&quot;line_bytes: %d line_padding_bytes:%d\n&quot;, line_bytes, line_padding_bytes);
     if (!file.read(reinterpret_cast&lt;char*&gt;(line), line_bytes))
       return {};  // Read failed.
     if (!file.seekg(line_padding_bytes, std::ios::cur))
@@ -117,18 +187,12 @@ std::vector&lt;std::pair&lt;int, float&gt;&gt; Sort(const std::vector&lt;float&gt;&amp; scores,
 }
 }  // namespace

-int main(int argc, char* argv[]) {
-  if (argc != 5) {
-    std::cerr &lt;&lt; argv[0]
-              &lt;&lt; &quot; &lt;model_file&gt; &lt;label_file&gt; &lt;image_file&gt; &lt;threshold&gt;&quot;
-              &lt;&lt; std::endl;
-    return 1;
-  }
-
-  const std::string model_file = argv[1];
-  const std::string label_file = argv[2];
-  const std::string image_file = argv[3];
-  const float threshold = std::stof(argv[4]);
+extern &quot;C&quot; int coral_classify(char *model_file_ptr, char *label_file_ptr, char *image_file_ptr, float thres, char **tags, size_t *out_len) 
+{
+  const std::string model_file (model_file_ptr);
+  const std::string label_file (label_file_ptr);
+  const std::string image_file (image_file_ptr);
+  const float threshold = thres;

   // Find TPU device.
   size_t num_devices;
@@ -151,7 +215,8 @@ int main(int argc, char* argv[]) {
   // Load image.
   int image_bpp, image_width, image_height;
   auto image =
-      ReadBmpImage(image_file.c_str(), &amp;image_width, &amp;image_height, &amp;image_bpp);
+      ReadBmpImageFromBuf(image_file_ptr, &amp;image_width, &amp;image_height, &amp;image_bpp);
+      //ReadBmpImage(image_file_ptr, &amp;image_width, &amp;image_height, &amp;image_bpp);
   if (image.empty()) {
     std::cerr &lt;&lt; &quot;Cannot read image from &quot; &lt;&lt; image_file &lt;&lt; std::endl;
     return 1;
@@ -174,7 +239,7 @@ int main(int argc, char* argv[]) {

   auto* delegate =
       edgetpu_create_delegate(device.type, device.path, nullptr, 0);
-  interpreter-&gt;ModifyGraphWithDelegate({delegate, edgetpu_free_delegate});
+  interpreter-&gt;ModifyGraphWithDelegate(delegate);

   // Allocate tensors.
   if (interpreter-&gt;AllocateTensors() != kTfLiteOk) {
@@ -204,9 +269,13 @@ int main(int argc, char* argv[]) {

   // Get interpreter output.
   auto results = Sort(Dequantize(*interpreter-&gt;output_tensor(0)), threshold);
+  *tags = strdup(GetLabel(labels, results[0].first).c_str());
+  *out_len = strlen(*tags);
+#if 0
   for (auto&amp; result : results)
     std::cout &lt;&lt; std::setw(7) &lt;&lt; std::fixed &lt;&lt; std::setprecision(5)
               &lt;&lt; result.second &lt;&lt; GetLabel(labels, result.first) &lt;&lt; std::endl;
+#endif

   return 0;
 }
</code></pre>
<pre><code>cd tflite
patch -p1 &lt; ../libify_classify.path
</code></pre>
<p>Alternatively you could just clone from our forked repo:</p>
<pre><code>git clone https://github.com/nubificus/tflite -b vaccel
</code></pre>
<p>Then, we need to install the requirements &amp; build tflite for google coral (could take some time, so please be patient ;-)).</p>
<h2 id="download-the-latest-edge-tpu-runtime">Download the latest Edge TPU runtime</h2>
<p>You can grab the latest Edge TPU runtime archive from
<a href="https://coral.ai/software/">https://coral.ai/software/</a>. Then extract it next
to the Makefile:</p>
<pre><code>cd tflite/cpp/examples/classification/
wget https://dl.google.com/coral/edgetpu_api/edgetpu_runtime_20200710.zip
</code></pre>
<h2 id="download-and-build-tensorflow">Download and build Tensorflow</h2>
<pre><code>git clone https://github.com/tensorflow/tensorflow.git
tensorflow/tensorflow/lite/tools/make/download_dependencies.sh
tensorflow/tensorflow/lite/tools/make/build_lib.sh
</code></pre>
<h2 id="build-the-shared-library">Build the shared library</h2>
<p>Finally, build the classify shared object that we will then link to the vAccel Google Coral TPU plugin.</p>
<pre><code class="language-sh">g++ -shared -fPIC -std=c++11 classify.cc
        -o /usr/local/lib/libclassify.so
        -I/data/tflite/cpp/examples/classification/edgetpu_runtime/libedgetpu/
        -Itensorflow/
        -Itensorflow//tensorflow/lite/tools/make/downloads/flatbuffers/include
        -Ltensorflow//tensorflow/lite/tools/make/gen/generic-aarch64_armv8-a/lib
        -Ledgetpu_runtime/libedgetpu/direct/aarch64/
        -l:libedgetpu.so.1.0 -lpthread -lm -ldl
        tensorflow/tensorflow/lite/tools/make/gen/linux_aarch64/lib/libtensorflow-lite.a
</code></pre>
<h2 id="build-vaccelrt-plugin">Build vAccelRT plugin</h2>
<p>Following the generic process for vAccelRT building (from <a href="/vaccelrt">Building vAccelRT</a>) we now have to enable the vAccel Google Coral Edge TPU plugin.</p>
<p>In short, the previous steps for vAccelRT were the following<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>:</p>
<pre><code>git clone --recursive https://github.com/cloudkernels/vaccelrt -b feat_gcoral_plugin
cd vaccelrt
mkdir build
cd build
cmake ../
</code></pre>
<p>The additional step now is to enable the plugin via cmake:</p>
<pre><code>cd vaccelrt
mkdir build_coral &amp;&amp; cd build_coral
cmake ../ -DBUILD_PLUGIN_CORAL=ON
</code></pre>
<p>The output of the above command should be something like the following:</p>
<pre><code>-- The C compiler identification is GNU 8.3.0
-- The CXX compiler identification is GNU 8.3.0
-- Check for working C compiler: /usr/bin/cc
-- Check for working C compiler: /usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /usr/bin/c++
-- Check for working CXX compiler: /usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Configuring done
-- Generating done
-- Build files have been written to: /data/vaccelrt/build_coral/googletest-download
Scanning dependencies of target googletest
[ 11%] Creating directories for 'googletest'
[ 22%] Performing download step (git clone) for 'googletest'
Cloning into 'googletest-src'...
Note: checking out 'release-1.8.1'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b &lt;new-branch-name&gt;

HEAD is now at 2fe3bd99 Merge pull request #1433 from dsacre/fix-clang-warnings
[ 33%] No patch step for 'googletest'
[ 44%] Performing update step for 'googletest'
[ 55%] No configure step for 'googletest'
[ 66%] No build step for 'googletest'
[ 77%] No install step for 'googletest'
[ 88%] No test step for 'googletest'
[100%] Completed 'googletest'
[100%] Built target googletest
-- Found PythonInterp: /usr/bin/python (found version &quot;2.7.16&quot;) 
-- Looking for pthread.h
-- Looking for pthread.h - found
-- Looking for pthread_create
-- Looking for pthread_create - not found
-- Check if compiler accepts -pthread
-- Check if compiler accepts -pthread - yes
-- Found Threads: TRUE  
-- Found rt: /usr/lib/aarch64-linux-gnu/librt.so  
Include directories: /data/vaccelrt/src
-- Configuring done
-- Generating done
-- Build files have been written to: /data/vaccelrt/build_coral
</code></pre>
<p>Finally, building the plugin is as simple as issueing a make command:</p>
<pre><code>make
</code></pre>
<p>The plugin is available at:</p>
<pre><code>vaccelrt/build_coral/plugins/coral/libvaccel-coral.so
</code></pre>
<h2 id="extra-files">Extra Files</h2>
<p>To run an example on the Google Coral Edge TPU, follow the instructions available at <a href="/run">Running a simple example</a>.</p>
<p>The files needed for classification are:</p>
<pre><code>mobilenet_v1_1.0_224_quant_edgetpu.tflite
imagenet_labels.txt
</code></pre>
<p>available for download from: <a href="https://github.com/google-coral/test_data">https://github.com/google-coral/test_data</a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Support for Google Coral is <a href="https://github.com/cloudkernels/vaccelrt/pull/14">WiP</a>, and will be available shortly in the main branch.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../virtio/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Virtio
              </div>
            </div>
          </a>
        
        
          <a href="../run/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Running a simple example
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2021 Nubificus LTD
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>